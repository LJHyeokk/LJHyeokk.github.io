I"{<h2 id="layered-patternì´ë€-">Layered Patternì´ë€ ğŸ™€</h2>

<center class="notice--danger">ë°±ì—”ë“œ APIë¥¼ êµ¬í˜„í• ë•Œ ë„ë¦¬ ì“°ì´ëŠ” íŒ¨í„´ì¤‘ ë ˆì´ì–´ë“œ ì•„í‚¤í…ì²˜(Layered achitecture) íŒ¨í„´ì´ ìˆë‹¤. ë ˆì´ì–´ë“œ ì•„í‚¤í…ì³ë¡œ APIë¥¼ êµ¬í˜„í• ë•ŒëŠ” ì—­í• ì— ë”°ë¼ ë…ë¦½ëœ ëª¨ë“ˆë¡œ ë‚˜ëˆ„ì–´ì„œ ì½”ë“œë¥¼ êµ¬í˜„í•œë‹¤.</center>

<center><img src="../images/2021-10-27-first/layered-1.png" alt="layered-1" /></center>

<p><strong>Route, Controller, Service, Model</strong> ê°ê°ì˜ ë ˆì´ì–´ê°€ í•˜ë‚˜ì˜ í´ë”ì´ì ì—­í• ì„ ì˜ë¯¸í•œë‹¤.</p>

<ol>
  <li>í° ë°•ìŠ¤ì—ì„œ ì‘ì€ ë°•ìŠ¤ë¡œ ê°ˆ ìˆ˜ë¡ ë” ë°ì´í„°ë¥¼ ë‹¤ë£¨ëŠ” ë¡œì§(ë°ì´í„°ë² ì´ìŠ¤ ì ‘ê·¼í•˜ëŠ” ë¡œì§)ì— ê·¼ì ‘í•˜ê²Œ ëœë‹¤.</li>
  <li>ë˜í•œ, ê°ê°ì˜ ë ˆì´ì–´ëŠ” <strong>ì˜¤ë¡œì§€</strong> ë°”ë¡œ ì•„ë˜ì— ìˆëŠ” ë ˆì´ì–´ì—ë§Œ ì˜ì¡´í•˜ê²Œ ëœë‹¤.
    <ul>
      <li>Route â†’ Controller</li>
      <li>Controller â†’ Service</li>
      <li>Service â†’ Model</li>
    </ul>
  </li>
</ol>

<p>ì˜ˆë¥¼ë“¤ì–´, Route ëŠ” Service ë¡œì§ì„ ì „í˜€ ëª¨ë¥´ê³  ì•„ì˜ˆ ê´€ì—¬ ì¡°ì°¨ í•˜ì§€ ì•ŠëŠ”ë‹¤.
ë”°ë¼ì„œ, Service ë¡œì§ì„ ë³€ê²½í•´ë„ Route ì™€ Controller ì˜ ì½”ë“œëŠ” ë°”ë€” í•„ìš”ê°€ ì—†ë‹¤.</p>

<p>ì¦‰ ë‹¤ìŒê³¼ ê°™ì€ ìƒí™©ì—ì„œ ìœ ì—°í•˜ê²Œ ëŒ€ì²˜í•  ìˆ˜ ìˆë‹¤ëŠ” ì˜ë¯¸ì´ë‹¤.</p>

<p>ë•Œë•Œë¡œ, ì„œë¹„ìŠ¤ë¥¼ êµ¬í˜„í•˜ë‹¤ê°€ RDBMS(ê´€ê³„í˜• ë°ì´í„° ë² ì´ìŠ¤) â†’ NoSQL(ex. mongoDB) ë¡œ ì´ì „í•˜ëŠ” ê²½ìš°ê°€ ìˆëŠ”ë°, Routeì™€ Controller ì˜ ë¡œì§ì€ ì „í˜€ ë°”ë€Œì§€ ì•Šì€ì±„ë¡œ ë°ì´í„°ë¥¼ ë‹¤ë£¨ëŠ” Service ì™€ Model ì˜ ë¡œì§ë§Œ ë³€ê²½ í•´ ì£¼ë©´ ëœë‹¤.</p>

<h2 id="ì‹¤ìŠµ">ì‹¤ìŠµ</h2>

<blockquote>
  <p>model</p>
</blockquote>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="err">{</span> <span class="nn">PrismaClient</span> <span class="o">}</span> <span class="n">from</span> <span class="err">'</span><span class="nd">@prisma</span><span class="o">/</span><span class="n">client</span><span class="err">'</span><span class="o">;</span>

<span class="kd">const</span> <span class="n">prisma</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PrismaClient</span><span class="o">();</span>

<span class="kd">const</span> <span class="n">productDetail</span> <span class="o">=</span> <span class="n">async</span> <span class="n">productId</span> <span class="o">=&gt;</span> <span class="o">{</span>
  <span class="kd">const</span> <span class="n">detail</span> <span class="o">=</span> <span class="n">await</span> <span class="n">prisma</span><span class="o">.</span><span class="n">$queryRaw</span><span class="err">`</span>
    <span class="no">SELECT</span>
      <span class="n">products</span><span class="o">.</span><span class="na">id</span><span class="o">,</span>
      <span class="n">eng_name</span><span class="o">,</span>
      <span class="n">price</span><span class="o">,</span>
      <span class="n">is_new</span><span class="o">,</span>
      <span class="n">is_main</span><span class="o">,</span>
      <span class="n">quantity</span><span class="o">,</span>
      <span class="n">sale_rate</span><span class="o">,</span>
      <span class="n">categories</span><span class="o">.</span><span class="na">name</span> <span class="n">as</span> <span class="n">cate_name</span><span class="o">,</span>
      <span class="n">subcategories</span><span class="o">.</span><span class="na">name</span> <span class="n">as</span> <span class="n">subcate_name</span><span class="o">,</span>
      <span class="n">url</span><span class="o">,</span>
      <span class="n">images</span><span class="o">.</span><span class="na">id</span> <span class="n">as</span> <span class="n">image_id</span>
    <span class="no">FROM</span>
      <span class="n">products</span>
    <span class="no">JOIN</span>
      <span class="n">categories</span> <span class="n">on</span> <span class="n">category_id</span> <span class="o">=</span> <span class="n">categories</span><span class="o">.</span><span class="na">id</span>
    <span class="no">JOIN</span>
      <span class="n">images</span> <span class="n">on</span> <span class="n">products</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">images</span><span class="o">.</span><span class="na">product_id</span>
    <span class="no">JOIN</span>
      <span class="n">subcategories</span> <span class="n">on</span> <span class="n">subcategories</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">subcategory_id</span>
    <span class="no">WHERE</span>
      <span class="n">products</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="err">$</span><span class="o">{</span><span class="n">productId</span><span class="o">};</span>
  <span class="err">`</span><span class="o">;</span>

  <span class="k">return</span> <span class="n">detail</span><span class="o">;</span>
<span class="o">};</span>

<span class="n">export</span> <span class="k">default</span> <span class="o">{</span> <span class="n">productDetail</span> <span class="o">};</span>

</code></pre></div></div>

<blockquote>
  <p>service</p>
</blockquote>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kn">import</span> <span class="err">{</span> <span class="nn">productDetailDao</span> <span class="o">}</span> <span class="n">from</span> <span class="err">'</span><span class="o">../</span><span class="n">models</span><span class="err">'</span><span class="o">;</span>

<span class="kd">const</span> <span class="n">productDetail</span> <span class="o">=</span> <span class="n">async</span> <span class="n">productId</span> <span class="o">=&gt;</span> <span class="o">{</span>
  <span class="kd">const</span> <span class="n">detail</span> <span class="o">=</span> <span class="n">await</span> <span class="n">productDetailDao</span><span class="o">.</span><span class="na">productDetail</span><span class="o">(</span><span class="n">productId</span><span class="o">);</span>

  <span class="kd">const</span> <span class="n">tmp</span> <span class="o">=</span> <span class="n">detail</span><span class="o">[</span><span class="mi">0</span><span class="o">];</span>

  <span class="n">tmp</span><span class="o">.</span><span class="na">url</span> <span class="o">=</span> <span class="n">detail</span><span class="o">.</span><span class="na">map</span><span class="o">((</span><span class="n">e</span><span class="o">,</span> <span class="n">i</span><span class="o">)</span> <span class="o">=&gt;</span> <span class="o">{</span>
    <span class="k">return</span> <span class="o">{</span> <span class="nl">id:</span> <span class="n">detail</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="err">'</span><span class="n">image_id</span><span class="err">'</span><span class="o">],</span> <span class="nl">image:</span> <span class="n">detail</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">url</span> <span class="o">};</span>
  <span class="o">});</span>

  <span class="k">return</span> <span class="n">detail</span><span class="o">[</span><span class="mi">0</span><span class="o">];</span>
<span class="o">};</span>

<span class="n">export</span> <span class="k">default</span> <span class="o">{</span> <span class="n">productDetail</span> <span class="o">};</span>


</code></pre></div></div>
:ET