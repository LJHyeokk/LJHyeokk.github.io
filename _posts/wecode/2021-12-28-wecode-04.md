---
layout: single
classes: wide
title: 'Webucks ë§Œë“¤ê¸° - node.js'

author_profile: ture
---

## backend ì‹œì‘ ~ ğŸ§‘â€ğŸ’»

<center>Wecodeì˜ ì„œë²„, nodeë¡œ ìœ„ë²…ìŠ¤ ì„œë²„ ë§Œë“¤ê¸°</center>
{: .notice--danger}

### ì‚¬ì „ì‘ì—….

1. node -v , npm -v ë²„ì „ì •ë³´ í™•ì¸
2. git init -y ( package.json ìƒì„±í™•ì¸ )
3. npm install express ( package.json dependenciesì— ìƒì„±ë˜ì—ˆëŠ”ì§€ í™•ì¸ - node5ë¶€í„°ëŠ” --saveí•˜ì§€ ì•Šì•„ë„ dependencyì— ì ìš©)
4. npm install prisma --save-dev
5. npm install @prisma/client
6. npm install dotenv nodemon -D
7. npx prisma init
8. prismaí´ë”ì™€ .evníŒŒì¼ ìƒì„±í™•ì¸
9. layered pattern ì ìš©ì‹œí‚¤ê¸°ìœ„í•´ í´ë” ìƒì„±

<br>
<center><img src="../images/2021-10-27-first/webucksNode-1.png" alt="webucksNode-1"  /></center>
<br>

<center>ì—¬ê¸°ê¹Œì§€ ì˜ë˜ì—ˆë‹¤ë©´ ì´ì œ ì‹œì‘í•´ë´…ì‹œë‹¤.</center>

> server.js

```java
import express from 'express';
import { PrismaClient } from '@prisma/client';
import routes from './pattern/routes';
import cookieParser from 'cookie-parser';
import cors from 'cors';

const prisma = new PrismaClient();
const PORT = 8060;
const app = express();

app.use(cors());
app.use(express.json()); //ë¯¸ë“¤
app.use(cookieParser());
app.use(routes);

const start = async () => {
  try {
    app.listen(PORT, () => console.log(`Server is listening on ${PORT}`));
  } catch (err) {
    console.error(err);
    await prisma.$disconnect();
  }
};

start();
```

ë‹¤ë¥¸ì„œë²„ì—ì„œì˜ ì ‘ì†ì„ í—ˆìš©í•˜ê¸° ìœ„í•´ corsë¥¼ install í•˜ì˜€ê³ 

ì¿ í‚¤ë¡œ ë°›ì€ ê°’ì„ í•´ì„í•˜ê¸° ìœ„í•´ cookie-parserë¥¼ install í•˜ì˜€ë‹¤.

useë¼ëŠ” ê²ƒì€ ë¯¸ë“¤ì›¨ì–´ë¡œ ì‚¬ìš©í•˜ê² ë‹¤ëŠ” ëœ»ì¸ë° ëª¨ë“  API ìš”ì²­ê³¼ ì‘ë‹µì‚¬ì´ì—ëŠ” ë¯¸ë“¤ì›¨ì–´ê°€ ì‹¤í–‰ì´ ëœë‹¤.

ê·¸ë ‡ê¸°ì— ì‹¤í–‰ ìˆœì„œê°€ ì¤‘ìš”í•˜ë‹¤.

## ì²«ë²ˆì§¸, prismaë¡œ mySQLê³¼ ì—°ë™í•˜ì—¬ í…Œì´ë¸” ìƒì„±í•˜ê¸°

> schema.prisma

```java
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}
```

> .env

```java
DATABASE_URL="mysql://root:"qqqqwwweer"@localhost:3306/we_starbucks_2"
//"mysql://USERNAME:PASSWORD@localhost:3306/DATABASE_NAME"
```

ìœ„ì™€ê°™ì´ ì„¤ì •ì‹œ mySQLê³¼ ì—°ë™ì´ ëœë‹¤.

<br>
<center><img src="../images/2021-10-27-first/webucksNode-2.png" alt="webucksNode-2"  /></center>
<br>

ìœ„ ì‚¬ì§„ê³¼ ê°™ì´ í…Œì´ë¸”ì„ ì‘ì„±í•œ í›„ `npx prisma migrate dev --name "ì‘ëª…"`

mySQLì— í…Œì´ë¸”ì´ ìƒì„±ëœë‹¤.

## ë‘ë²ˆì§¸, layered patternì„ í™œìš©í•˜ì—¬ Daoë‹¨ì—ì„œ í…Œì´ë¸”ì„ ì¡°ì‘í•œë‹¤.

> productDao.js

```java
// coffee listì— ì¶”ê°€í•˜ê¸°
const createProducts = async (
  id,
  korean_name,
  english_name,
  drink_info,
  is_new,
  category_id
) => {
  await prisma.$queryRaw`
    INSERT INTO
      drinks
        (id,
        korean_name,
        english_name,
        drink_info,
        is_new,
        category_id)
    VALUES
      (${id},
      ${korean_name},
      ${english_name},
      ${drink_info},
      ${is_new},
      ${category_id});`;
  return;
};
// coffee english_name ë³€ê²½í•˜ê¸°
const updateProduct = async (id) => {
  await prisma.drinks.update({
    where: {
      id: +id,
    },
    data: {
      english_name: 'new_coffe',
    },
  });
  return;
};
```

queryRawë¥¼ í†µí•´ mySQLì˜ ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ì—¬ í…Œì´ë¸”ì˜ ë°ì´í„°ë¥¼ ì¡°ì‘í•˜ëŠ” ë°©ë²•ê³¼

prismaì˜ ê°€ê³µëœ ë©”ì„œë“œë¥¼ í†µí•´ í…Œì´ë¸”ì„ ì¡°ì‘í•˜ëŠ” ë°©ë²•ì´ ìˆë‹¤.

## ì„¸ë²ˆì§¸, routerë¥¼ í†µí•´ controllerë‹¨, middleWareì„ ì‹¤í–‰ì‹œí‚¨ë‹¤.

> productsRouter.js

```java
import express from 'express';
import { productController } from '../controllers';
import { admin_authorization } from '../../middleWare/auth';
const router = express.Router();

router.get('/', admin_authorization, productController.getProduct);
router.post('/', admin_authorization, productController.createProduct);
router.put('/', admin_authorization, productController.updateProduct);
router.delete('/', admin_authorization, productController.deleteProduct);

router.post('/likes', productController.likeProduct);

export default router;
```

í´ë¼ì´ì–¸íŠ¸ì˜ ìš”ì²­ì— ë§ê²Œ CRUDë¥¼ ì ì–´ì¤€ë‹¤.
