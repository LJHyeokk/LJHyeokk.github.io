---
layout: single
classes: wide
title: "Kubernetes"

author_profile: ture
---

## Kubernetes ğŸ’¯

<center>Kubernetes, ë˜ëŠ” ì¿ ë²„ë„¤í‹°ìŠ¤, ë˜ëŠ” ê°„ë‹¨íˆ "íë¸Œ(kube)"ëŠ” Linux ì»¨í…Œì´ë„ˆ ì‘ì—…ì„ ìë™í™”í•˜ëŠ” ì˜¤í”ˆì†ŒìŠ¤ í”Œë«í¼ì´ë‹¤.</center>
{: .notice--info}

<br>
<center><img src="../images/2021-10-27-first/k8-1.png" alt="k8" /></center>
<br>

1. Localì—ì„œ ì‹¤í–‰ // node hellow.js

2. dockerì—ì„œ nodeì´ë¯¸ì§€ë¥¼ ê°€ì ¸ì™€ hellow.jsë¥¼ copyí•˜ì—¬ ì´ë¯¸ì§€ë¥¼ ìƒì„± í›„ hubì— ì˜¬ë¦¬ê¸°

```java
FROM node:slim
EXPOSE 8000
COPY hellow.js
CMD node hellow.js

>> docker build -t ì´ë¯¸ì§€ëª… .

>> docker login

>> docker push ì´ë¯¸ì§€ëª…
```

3. Kubernetesì—ì„œ ë„ìš°ê¸°

```java
apiVersion : v1
kind : pod
metadata :
    name : hellow-pod
    labels :
        app : hellow
spec :
    containers :
        -name : hellow-container
         image : ì´ë¯¸ì§€ëª…
         ports :
            -containerPorts : 8000

-------------------------------------------------

apiVersion : v1
kind : Service
metadata :
    name : hellow-svc
spec :
    selector :
        app : hellow
    ports :
       - port : 8200
         targetPort : 8000
    externallPs :
        192.xxx.x.xx
```

### Service

1.  ClusterIp : ì™¸ë¶€ì—ì„œ ì ‘ê·¼í•  ìˆ˜ ì—†ê³  í´ëŸ¬ìŠ¤í„° ë‚´ì—ì„œ ì‚¬ìš©í•˜ëŠ” IPì´ë¯€ë¡œ ì¸ê°€ëœ ì‚¬ìš©ìë§Œ ê°€ëŠ¥ ( ì£¼ë¡œ Podì˜ ìƒíƒœê´€ë¦¬ ë° ë””ë²„ê¹…) ë””í´íŠ¸ê°’

2.  NodePort : ë¬¼ë¦¬ì ì¸ IPë¥¼ í†µí•´ Podì— ì ‘ê·¼ê°€ëŠ¥, ì„ì‹œ ì—°ê²°ìš©

3.  LB : ì™¸ë¶€ ì‹œìŠ¤í…œ ì—°ê²°ìš©

 <br>

### Volume

1.  emptyDir : Podìƒì„±ì‹œ ë§Œë“¤ì–´ì§€ê³  ì‚­ì œì‹œ ì—†ì–´ì§ ( ì§€ì •í•œ ì»¨í…Œì´ë„ˆë¼ë¦¬ íŒŒì¼ê³µìœ  ê°€ëŠ¥ )

2.  hostPath : Podê°€ ì£½ì–´ë„ ì‚¬ë¼ì§€ì§„ì•Šì§€ë§Œ ì£½ì€ Podê°€ ë‹¤ë¥¸ ë…¸ë“œì— ìƒê¸¸ë•Œ ì›ë˜ì˜ ë…¸ë“œì˜ Volumeê³¼ ì—°ê²°ì´ ì•ˆë˜ì„œ ìì²´ì ìœ¼ë¡œ ë”°ë¡œ ì—°ê²°í•´ì¤˜ì•¼í•¨ ( ì£¼ ìš©ë„ëŠ” Nodeì•ˆì˜ Volumeì— ìˆëŠ” ë°ì´í„°ë¥¼ Podê°€ ì‚¬ìš©í•˜ê¸°ìœ„í•´ ì‚¬ìš©)

3.  PVC / PV : Podê°€ ë§Œë“¤ì–´ì§ˆë•Œ ì§€ì •í•œ ì˜ì—­ì— ë§Œë“¤ì–´ì§. PVC => PV

<br>

### ConfigMap, Secret

1. Env (Literal) : ë‘˜ë‹¤ í‚¤,ë²¨ë¥˜ë¡œ ì´ë£¨ì–´ì§„ ìŒì„ ìƒìˆ˜ë¡œ ì €ì¥, Secretì€ 1Mbyte, base64ë¡œ ì¸ì½”ë”©ëœ ê°’ ë„£ì–´ì¤˜ì•¼í•¨

2. Env (File) : íŒŒì¼ë¡œ ì„¤ì •

3. Volume Mount (File) : Volume Pathì— EnvíŒŒì¼ ì„¤ì •, mountëœê²ƒì´ ë°”ë€Œë©´ ë°”ë€œ

<br>

### Namespace, ResourceQuota, LimitRange

1. Namespace : Podì´ë¦„ ì¤‘ë³µ X, ë‹¤ë¥¸ Namespaceì™€ ì—°ê²° X

2. ResourceQuota : Podë§Œë“¤ë•Œ resourceë¥¼ ëª…ì‹œí•˜ê²Œ í•´ì¤Œ, Podì•„ë¬´ê²ƒë„ì—†ì´ ë§¨ì²˜ìŒ ë§Œë“¤ì–´ì¤˜ì•¼í•¨

3. LimitRange : min, max, defaultê°’

<br>

### Template, Replicas, Selector

1. Template : Selectorë¡œ ì§€ì •ëœ Podë¥¼ Replicasì˜ ìˆ˜ì¹˜ë§Œí¼ ì¬ìƒì„±í•´ì¤Œ(ë²„ì „ë„ ë°”ë¡œë°”ë¡œ ì—…ê¸€ê°€ëŠ¥)

2. Replicas : ìˆ˜ì¹˜ë§Œí¼ Podê°€ ì£½ì—ˆì„ ê²½ìš° ì¬ìƒì„±

3. Selector : matchLabels(ì •í™•íˆ ì¼ì¹˜í•˜ëŠ”ê²ƒ), matchExpressions(conditionì— í•´ë‹¹í•˜ëŠ”ê²ƒ) => Exists, DoesNotExist, In, NotIn

<br>

### Deployment

1. reCreate : ë²„ì „ì—… ì‹œ Downtimeì´ ì¡´ì¬í•¨

2. Rolling Update : ì¼ë‹¨ v2ë¥¼ ë§Œë“¤ê³  v1ì„ ì§€ìš´ë‹¤. ( ê·¸ ì‚¬ì´ì— v1, v2ì— ì‚¬ìš©ìê°€ ëª¨ë‘ ë“¤ì–´ê°ˆ ìˆ˜ ìˆìŒ, ìì›ì´ ìˆœê°„ì ìœ¼ë¡œ ë§ì´ í•„ìš” )

3. Blue/Green : ì„œë¹„ìŠ¤ë¥¼ í†µí•´ v1 -> v2ë¡œ Podë¥¼ ë°”ê¿”ì¤€ë‹¤. ( ìì›ì‚¬ìš©ëŸ‰ 2ë°°, v2ê°€ ë¬¸ì œê°€ ìƒê¸°ë©´ ë°”ë¡œ v1ìœ¼ë¡œ ë°”ê¿”ì¤Œ )

4. Canary : ì„œë¹„ìŠ¤ë¥¼ í†µí•´ [(1. ty:app, ver:v1)(2. ty:app, ver:v1)],[(3. ty:app, ver:v2)] ì´ë ‡ê²Œ v1,v2ë¥¼ ì‚¬ìš©í•˜ê²Œ í•˜ë‹¤ê°€ ë¬¸ì œê°€ ìƒê¸°ë©´ v2ë¥¼ ëŠìŒ, ë˜ ë‹¤ë¥¸ ë°©ì‹ìœ¼ë¡œ PATHë¥¼ ë³€ê²½í•¨ìœ¼ë¡œì¨ v1,v2ë¥¼ ê³µì¡´ì‹œí‚´

<br>

### DaemonSet, Job, CronJob

1. DeamonSet : Nodeì˜ ìì›ìƒíƒœë¥¼ ê³ ë ¤í•˜ì§€ ì•Šê³  ê° Nodeë§ˆë‹¤ 1ê°œì”© Podìƒì„± (Prometheus, Fluentd, GlusterFS)

2. Job : Podê°€ ì£½ìœ¼ë©´ ê·¸ëŒ€ë¡œ ìì›ì„ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ìƒíƒœë¡œ ë†”ë‘ , parallelism, completions, activeDeadlineSeconds

3. CronJob : ë‚´ê°€ ì•Œê³ ìˆëŠ” ê·¸ê²ƒ, Allow, Forbid, Replace
